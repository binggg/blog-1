<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  <video id="yours" autoplay></video>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
  <script>
    console.log(io)
    var socket = io();
    var pc = null;
    var ice = {
      "iceServers": [
          { "url": "stun:stun.l.google.com:19302" }, //使用google公共测试服务器
          { "url": "turn:user@turnserver.com", "credential": "pass" } // 如有turn服务器，可在此配置
      ]
    };
    socket.on('siganling', function(msg) {
      if (msg.offer) { // 监听并处理通过发信通道交付的远程提议
        pc = new RTCPeerConnection(ice);
        pc.setRemoteDescription(msg.offer);
        navigator.getUserMedia({ "audio": true, "video": true }, gotStream, logError);
      } else if (msg.candidate) { // 注册远程ICE候选项以开始连接检查
          pc.addIceCandidate(msg.candidate);
      }
    })
    function gotStream(evt) {
      pc.addstream(evt.stream);
      var local_video = document.getElementById('video');
      local_video.src = window.URL.createObjectURL(evt.stream);
      pc.createAnswer(function (answer) { // 生成描述端连接的SDP应答并发送到对端
          pc.setLocalDescription(answer);
          socket.emit('siganlingTo', answer.sdp)
      });
   }
  </script>
</body>
</html>